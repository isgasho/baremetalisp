\documentclass{article}

\usepackage{amsmath,amssymb}
\usepackage{fixltx2e}
\usepackage[dvipdfmx]{hyperref,graphicx}

\title{Typing Rule of Baremetalisp}
\author{Yuuki Takano}

\begin{document}

\maketitle

\begin{table}[tb]
\caption{Notation}
    \centering
    \begin{tabular}{rl}
        $x$ & variable \\
        $T$ & type variable \\
        $D$ & type name of user defined data \\
        $L$ & label of user defined data \\
        $\mathcal{T}$ & type \\
        $C$ & constraint \\
        $\Gamma$ & context \\
        $L_{type} : L \rightarrow \mathcal{T}$ & function from label to type \\
        $L_{nth} : L \rightarrow \mathtt{Int} \rightarrow \mathcal{T}$ & function to n-th type of label $L$ \\
        $\mathcal{P}_{let}$ & pattern of let expression \\
        $\mathcal{T}_1 \equiv_\alpha \mathcal{T}_2$ & $\mathcal{T}_1$ and $\mathcal{T}_2$ are $\alpha$-equivalent \\
        $\mathcal{S}$ & substitution \\
        $\mathcal{T}[\mathcal{S}]$ & apply a substitution $\mathcal{S}$ to a type $\mathcal{T}$ \\
        $\{T\}$ & set of $T$ \\
        $FV_\mathcal{T} : \mathcal{T} \rightarrow \{T\}$ & function from a $\mathcal{T}$ to its free variables\\
        $FV_\Gamma : \Gamma \rightarrow \{T\}$ & function from a $\Gamma$ to its free variables\\
    \end{tabular}
\end{table}

\begin{figure}[tb]
    \centering
    \begin{tabular}{rrll}
    $\Gamma$ & :=  & $x : \mathcal{T}, \Gamma$ & context\\
        & $|$ & $\varnothing$ \\ \\

    $\mathcal{S}$ & :=  & $T \rightarrow \mathcal{T}, \mathcal{S}$ & substitution \\
        & $|$ & $\varnothing$ \\ \\

    $\mathcal{C}$ & :=  & $\mathcal{T} = \mathcal{T}, \mathcal{C}$ & constraint \\
        & $|$ & $\varnothing$ \\ \\

    $\mathcal{T}$ & :=  & $\mathtt{Int}$ \\
        & $|$ & $\mathtt{Bool}$ \\
        & $|$ & $'(\mathcal{T})$ & list type \\
        & $|$ & $[\mathcal{T}+]$ & tuple type \\
        & $|$ & $D$    & user defined type \\
        & $|$ & $(D\ \mathcal{T}+)$ & user defined type with type arguments \\
        & $|$ & $T$ & type variable \\ \\

    $\mathcal{P}_{let}$ & :=  & $x$ \\
        & $|$ & $(L\ \mathcal{P}_{let}+)$ & label with patterns \\
        & $|$ & $[\mathcal{P}_{let}+]$ & tuple \\
    \end{tabular}
    \caption{Syntax}
\end{figure}

\begin{figure}
    \centering
    \begin{tabular}{rlrl}
        $\Gamma \vdash \mathtt{true} : \mathtt{Bool}\ |_\varnothing\ \{\}$ & (T-True) &
        $\Gamma \vdash \mathtt{false} : \mathtt{Bool}\ |_\varnothing\ \{\}$ & (T-False) \vspace{5mm} \\

        $\dfrac{x : T \in \Gamma}{\Gamma \vdash x : T\ |_{\{\}}\ \{\}}$ & (T-Var) \vspace{5mm} \\

        \multicolumn{3}{r}{
        $\dfrac{\begin{aligned}
        &\Gamma \vdash \mathcal{P}_{let} : T_0\ |_{\mathcal{X}_0}\ C_0 \hspace{5mm}
        \Gamma \vdash e_1 : T_1\ |_{\mathcal{X}_1}\ C_1 \hspace{5mm}
        \Gamma \vdash e_2 : T_2\ |_{\mathcal{X}_2}\ C_2\\
        &\mathcal{X}_0 \cap \mathcal{X}_1 \cap \mathcal{X}_2 = \varnothing \hspace{5mm}
        C = C_0 \cup C_1 \cup C_2 \cup \{ T_0 = T_1 \}
        \end{aligned}}{\Gamma \vdash (\mathtt{let1}\ \mathcal{P}_{let}\ e_1\ e_2) : T_2\ |_{\mathcal{X}_0 \cup \mathcal{X}_1 \cup \mathcal{X}_2}\ C}$} & (T-Let1) \vspace{5mm} \\

        \multicolumn{3}{r}{
        $\dfrac{\begin{aligned}
        &\Gamma \vdash e_1 : T_1\ |_{\mathcal{X}_1}\ C_1 \hspace{5mm} \Gamma \vdash e_2 : T_2\ |_{\mathcal{X}_2}\ C_2 \hspace{5mm} \Gamma \vdash e_3 : T_3\ |_{\mathcal{X}_3}\ C_3 \\
        &\mathcal{X}_1 \cap \mathcal{X}_2 \cap \mathcal{X}_3 = \varnothing \hspace{5mm} C = C_1 \cup C_2 \cup C_3 \cup \{ T_1 = \mathtt{Bool}, T_2 = T_3 \}
        \end{aligned}}{\Gamma \vdash (\mathtt{if}\ e_1\ e_2\ e_3) : T_2\ |_{\mathcal{X}_1 \cup \mathcal{X}_2 \cup \mathcal{X}_3}\ C}$} & (T-If) \vspace{5mm} \\
    \end{tabular}
    \caption{Typing rule}
\end{figure}


\begin{figure}
    \centering
    \begin{tabular}{rlrl}
        $\dfrac{x : T \in \Gamma}{\Gamma \vdash x : T\ |_{\{\}}\ \{\}}$ & (PL-Var) \vspace{5mm} \\

        \multicolumn{3}{r}{
        $\dfrac{
        \begin{aligned}
        &\Gamma \vdash \mathcal{P}_{let_1} : T_1\ |_{\mathcal{X}_1}\ C_1 \land \cdots \land
        \Gamma \vdash \mathcal{P}_{let_n} : T_n\ |_{\mathcal{X}_n}\ C_n \\
        &L_{type}(L)[\mathcal{S}]\equiv_\alpha T_0 \hspace{5mm} FV(T_0) \cap \mathcal{X}_1 \cap \cdots \cap \mathcal{X}_n = \varnothing \\
        &FV_\mathcal{T}(T_0) \cap FV_\Gamma(\Gamma) = \varnothing \hspace{5mm}
        \mathcal{X} = FV(T_0) \cup \mathcal{X}_1 \cup \cdots \cup \mathcal{X}_n \\
        &C = \{L_{nth}(L, 1)[\mathcal{S}] = T_1, \cdots, L_{nth}(L, n)[\mathcal{S}] = T_n\} \cup C_1 \cup \cdots \cup C_n
        \end{aligned}
        }{\Gamma \vdash (L\ \mathcal{P}_{let_1}\ \cdots\ \mathcal{P}_{let_n}) : T_0\ |_{\mathcal{X}}\ C}$} & (PL-Label) \vspace{5mm} \\

        \multicolumn{3}{r}{
        $\dfrac{
        \begin{aligned}
        &\Gamma \vdash \mathcal{P}_{let_1} : T_1\ |_{\mathcal{X}_1}\ C_1 \land \cdots \land
        \Gamma \vdash \mathcal{P}_{let_n} : T_n\ |_{\mathcal{X}_n}\ C_n \\
        &\mathcal{X}_1 \cap \cdots \cap \mathcal{X}_n = \varnothing \hspace{5mm}
        \mathcal{X} = \mathcal{X}_1 \cup \cdots \cup \mathcal{X}_n \hspace{5mm}
        C = C_1 \cup \cdots \cup C_n
        \end{aligned}
        }{\Gamma \vdash [\mathcal{P}_{let_1}\ \cdots\ \mathcal{P}_{let_n}] : [T_1 \cdots T_n]\ |_{\mathcal{X}}\ C}$} & (PL-Tuple) \\
    \end{tabular}
    \caption{Typing rule of let expression's pattern}
\end{figure}

\end{document}